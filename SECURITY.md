# 🔐 RBAC Admin System - 安全配置指南

## 🚨 重要安全提醒

在部署和使用本系统时，请务必遵循以下安全最佳实践，保护您的系统和数据安全。安全是一个持续的过程，需要定期审查和更新！

## 🛡️ 敏感信息保护

### 1. 配置文件安全

#### ⚠️ 绝不要提交到Git的文件：
- `settings.yaml` - 包含数据库密码、JWT密钥等敏感信息
- `settings_dev.yaml` - 开发环境配置
- `settings_test.yaml` - 测试环境配置（如存在）
- `*.key`, `*.pem` - 密钥和证书文件（如使用HTTPS）
- `logs/` - 日志文件目录（可能包含敏感操作记录）

确保您的 `.gitignore` 文件正确配置，忽略上述敏感文件。

#### ✅ 安全的配置模板：
- `settings.yaml.example` - 配置模板文件，只包含示例值，不含真实凭据

### 2. 数据库安全配置

#### 数据库连接配置：
```yaml
db:
    mode: mysql
    host: localhost      # 生产环境使用内网IP，避免公网暴露
    port: 3306
    user: rbac_user      # 使用专用用户，而非root
    password: YOUR_STRONG_PASSWORD_HERE  # 使用强密码
    db_name: rbacAdmin
```

#### 数据库安全建议：
- 🔑 **使用强密码**：至少12位，包含大小写字母、数字和特殊字符
- 👤 **创建专用用户**：不要使用root用户连接应用，为应用创建专用数据库用户并分配最小必要权限
- 🔒 **限制访问IP**：配置数据库只允许应用服务器IP访问，避免公网访问
- 🛡️ **启用SSL连接**：生产环境强烈建议启用数据库SSL连接加密
- 📋 **定期备份**：设置自动备份策略，并将备份存储在安全位置
- 🗄️ **定期清理**：定期清理过期数据，优化数据库性能和安全性

### 3. Redis安全配置

```yaml
redis:
    addr: localhost:6379
    password: YOUR_REDIS_PASSWORD  # 必须设置强密码
    db: 0                          # 使用专用数据库编号
```

#### Redis安全建议：
- 🔑 **设置密码**：为Redis设置强密码，避免未授权访问
- 🔒 **绑定本地IP**：配置Redis仅绑定本地回环地址，禁止公网访问
- 🛡️ **禁用危险命令**：在Redis配置中禁用FLUSHDB、FLUSHALL、KEYS等危险命令
- 📊 **监控访问**：启用Redis访问日志，定期检查异常访问
- 🔐 **使用Redis ACL**：如果Redis版本支持，配置更精细的访问控制列表

### 4. JWT安全配置

```yaml
jwt:
    secret: YOUR_JWT_SECRET_KEY_HERE  # 使用强密钥，建议至少32位随机字符
    expire: 24                         # 设置合理的过期时间（单位：小时）
    issuer: rbacAdmin                  # 设置唯一的颁发者
```

#### JWT安全建议：
- 🔑 **使用强密钥**：使用密码生成工具创建随机、复杂的JWT密钥
- 🔄 **定期更换密钥**：制定密钥轮换策略，定期更换JWT密钥
- ⏱️ **合理设置过期时间**：根据应用场景设置合适的Token过期时间，通常不超过7天
- 🚨 **处理密钥泄露**：如怀疑密钥泄露，立即更换密钥并强制所有用户重新登录

## 🔧 多环境配置指南

### 开发环境
```yaml
# settings_dev.yaml
system:
    mode: debug
    ip: 127.0.0.1
    port: 8080

db:
    mode: sqlite  # 开发环境推荐使用SQLite，避免依赖外部数据库
    host: rbac_dev.db
```

### 测试环境
```yaml
# settings_test.yaml
system:
    mode: release
    ip: 127.0.0.1
    port: 8081

db:
    mode: mysql
    host: localhost
    user: test_user
    password: TEST_PASSWORD
    db_name: rbac_test
```

### 生产环境
```yaml
# settings_prod.yaml
system:
    mode: release     # 生产环境必须使用release模式
    ip: 0.0.0.0       # 监听所有网卡（如果使用反向代理）
    port: 8080

db:
    mode: mysql
    host: db.internal  # 使用内网地址或主机名
    user: rbac_prod
    password: PRODUCTION_STRONG_PASSWORD
    db_name: rbac_production

# 其他配置项也应使用生产环境的安全设置
```

## 🚀 部署安全建议

### 1. 服务器安全
- 🔄 **定期更新**：保持操作系统、依赖库和应用程序更新到最新版本
- 🔥 **配置防火墙**：只开放必要的端口（如80/443），限制访问源IP
- 👥 **使用非root用户**：运行应用的用户权限最小化，禁止使用root用户
- 🔍 **监控日志**：配置日志收集和分析系统，定期检查系统和应用日志
- 🚪 **禁用不必要的服务**：关闭服务器上不必要的网络服务和端口
- 📊 **系统监控**：配置系统资源和性能监控，及时发现异常

### 2. 网络安全
- 🔒 **使用HTTPS**：生产环境必须启用HTTPS，配置有效的SSL/TLS证书
- 🔄 **证书管理**：定期更新SSL/TLS证书，避免证书过期
- 🛡️ **配置CORS**：合理配置跨域资源共享，限制允许的源和方法
- 📍 **IP白名单**：对管理后台接口配置IP白名单访问控制
- 🧱 **使用反向代理**：前端放置Nginx等反向代理，隐藏真实应用服务器信息
- 🛡️ **WAF保护**：考虑部署Web应用防火墙，防御常见的Web攻击

### 3. 应用安全
- 🔑 **JWT密钥安全**：使用环境变量或密钥管理系统存储JWT密钥，避免硬编码
- 📝 **输入验证**：严格验证所有用户输入，防止XSS和注入攻击
- 🛡️ **SQL注入防护**：使用GORM的参数化查询，避免拼接SQL语句
- 📊 **错误处理**：统一错误处理机制，不要向客户端暴露敏感错误信息
- 🔐 **密码安全**：使用bcrypt或Argon2等强密码哈希算法，设置密码复杂度要求
- 🚫 **防止暴力破解**：实现登录失败次数限制，防止暴力破解攻击
- 📁 **文件上传安全**：限制文件上传类型和大小，对上传文件进行病毒扫描
- 🧹 **清理旧会话**：定期清理过期的会话和Token

## 📝 安全检查清单

在部署前，请确认：

- [ ] 已修改所有默认密码和密钥
- [ ] 已配置.gitignore忽略所有敏感文件
- [ ] 已创建专用数据库用户，权限最小化
- [ ] 已设置数据库访问IP限制
- [ ] 已配置Redis密码和访问限制
- [ ] 已使用强JWT密钥并设置合理过期时间
- [ ] 已启用HTTPS（生产环境）
- [ ] 已配置防火墙规则，只开放必要端口
- [ ] 已设置日志监控和告警
- [ ] 已创建定期备份策略
- [ ] 已进行安全测试（如渗透测试）
- [ ] 已禁用开发环境的调试信息（生产环境）
- [ ] 已配置CORS策略

## 🚨 紧急情况处理

### 安全事件响应流程

1. **检测与确认**：通过日志监控或告警系统发现安全事件
2. **隔离与控制**：立即隔离受影响系统，防止事件扩大
3. **分析与调查**：收集证据，确定事件根源和影响范围
4. **修复与恢复**：修复漏洞，恢复系统正常运行
5. **报告与通知**：按照组织规定报告安全事件
6. **总结与改进**：分析事件原因，完善安全措施

### 常见安全事件处理

#### 密码泄露
1. 立即更改所有相关密码（数据库、Redis、管理员账户等）
2. 检查系统和应用日志，识别未授权访问
3. 强制所有用户重新设置密码
4. 更新所有配置文件并重新部署应用
5. 分析泄露原因，采取措施防止再次发生

#### 系统入侵
1. 立即断开受影响服务器的网络连接
2. 保存所有日志和系统状态作为证据
3. 对系统进行全面安全扫描，识别恶意软件和后门
4. 使用干净备份恢复系统，或重新安装系统和应用
5. 加强安全措施后再重新连接网络

#### 数据泄露
1. 确认泄露的数据类型和范围
2. 通知相关方（用户、监管机构等），根据适用法律要求
3. 采取措施防止进一步泄露
4. 分析泄露原因，改进安全措施
5. 考虑提供身份保护服务（如适用）

## 📞 安全支持

如发现安全漏洞或有安全建议：
1. **不要公开披露**：在漏洞修复前，不要公开披露漏洞详情
2. **私密渠道报告**：通过项目的私密安全联系方式报告漏洞
3. **提供详细信息**：包括漏洞描述、复现步骤和可能的影响
4. **等待修复**：等待项目维护者提供修复方案后再公开

---

**记住：安全是一个持续的过程，需要定期审查和更新！**